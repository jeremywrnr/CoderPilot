<!--git controls and api stuff here-->

<template name="git">
  <div class="col-s-8 full-height">
    {{#if isPilot}}
    {{> commitPanel }}
    {{/if}}

    {{> history }}
  </div>
</template>

<template name="statusPanel">
  {{#if changes}}

  <div class="list-group nomargin">
    <!--<pre>old / new line numbers </pre>-->

    {{#each diffs}}
    {{> diff}}
    {{/each}}
  </div>

  {{else}}

  <div class="alert alert-info nomargin" role="alert">
    No changes to be committed yet. Your edits will be shown here once you change your files!
  </div>

  {{/if}}
</template>

<template name="commitPanel">
  <div class="panel panel-primary">

    {{#if committing}}
    <div class="panel-heading">
      <h3 class='panel-title'> Code saved! Commit in progress... </h3>
    </div>
    <div class="panel-body">
      <div class="alert alert-success">
        <div class="input-group">
          <form class="committer">
            <input placeholder="enter a commit message..."
                   id="commitMsg" class="form-control" type="text" name="title" value="">
          </form>
          <span class="input-group-btn">
            <button type="button" class="btn btn-default del cancelCommit">cancel</button>
          </span>
        </div>
      </div>

      {{> statusPanel }}

      <!--<a target="_blank" href="https://octodex.github.com/">-->
      <!--<img class="center wide" src="https://octodex.github.com/images/nyantocat.gif"/>-->
      <!--[><img class="center" style="width:40%;" src="http://random-octocat.herokuapp.com"/><]-->
      <!--</a>-->
    </div>

    {{else}}

    <div class="panel-heading">
      <div class="btn-group btn-group-justified">
        <div class="btn-group" role="group">
          <a href="#">
            {{#if changes}}
            <button type="button" class="btn btn-default btn-lg"> new commit </button>
            {{else}}
            <button type="button" class="btn btn-default btn-lg grn newcommit"> new commit </button>
            {{/if}}
          </a>
        </div>

        <div class="btn-group" role="group">
          <a href="#">
            <button type="button" class="btn btn-default btn-lg grn refresh"> refresh </button>
          </a>
        </div>

        <div class="btn-group" role="group">
          <a href="#">
            <button type="button" class="btn btn-default btn-lg del loadhead">import {{branch}}</button>
          </a>
        </div>
      </div>

    </div>

    <div class="panel-body">
      {{> statusPanel }}
    </div>
    {{/if}}
  </div>
</template>



<template name="history">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h3 class="panel-title">
        recent commits ({{ commitCount }})
        <button class='btn btn-xs grn btn-default pull-right reload'> reload </button>
      </h3>
    </div>

    <div class="panel-body">
      <div class="list-group nomargin">
        {{#each commits}}
        {{> commit}}
        {{/each}}
      </div>
    </div>
  </div>
</template>

<template name="commit">
  {{#if current}}

  <button class="list-group-item commit" id="active-commit" href="#">
    {{ commit.commit.message }}
    <span class="pull-right label {{#if mine}}label-primary{{else}}label-info{{/if}}">
      {{ commit.author.login }}
    </span>
  </button>
  <li class="list-group-item" href="#">
    <div class="btn-group btn-group-justified">
      <div class="btn-group" role="group">
        <a class="btn btn-group grn" target="_blank" href="{{ commit.html_url }}"> view diff </a>
      </div>

      <div class="btn-group" role="group">
        <a href="https://github.com/{{ currentUser.profile.repoOwner }}/{{ currentUser.profile.repoName }}/tree/{{ sha }}"
           class="btn btn-group grn" target="_blank" > browse code </a>
      </div>

      <div class="btn-group" role="group">
        <button class="btn btn-group del loadcommit"> import </button>
      </div>
    </div>
  </li>

  {{else}}

  <button class="list-group-item commit" href="#">
    {{ commit.commit.message }}
    <span class="pull-right label {{#if mine}}label-primary{{else}}label-info{{/if}}">
      {{ commit.author.login }}
    </span>
  </button>

  {{/if}}
</template>



<template name="diff">
  <li class="list-group-item list-group-item-info"> {{title}}
    <button class="btn btn-xs del btn-default pull-right reset">reset</button>
  </li>

  <li class="list-group-item">
    {{#each lines}}
    {{> diffline }}
    {{/each}}
  </li>
</template>

<template name="diffline">
  {{#if skipped}}
  <!--<pre> ... </pre>-->
  <!--not in context-->

  {{else}}{{#if equal}}
  <pre class="diff"> <span class="lineno">{{ newnum }}&gt;</span> {{ content }} </pre>

  {{else}}{{#if deleted}}
  <pre class="diff del"> <span class="lineno">{{ newnum }}&gt;</span> {{ content }} </pre>

  {{else}}{{#if inserted}}
  <pre class="diff ins grn"> <span class="lineno">{{ newnum }}&gt;</span> {{ content }} </pre>

  {{/if}}{{/if}}{{/if}}{{/if}}
</template>

